function go_to(e){mod_server_url=window.server_url+e+" #body_page  > *",$("#body_page").load(mod_server_url,function(a,s,d){"error"==s?($(".md_loading").modal("hide"),$(".md_error").modal("show")):(cc_cancel(),au_cancel(),$("#upload_file").val(""),$("#form_file")[0].reset(),$("#select_friend").empty(),$("#select_friend").load(window.modal_1_url),parseInt(e)>-1&&($("#au_select_friend").empty(),$("#au_select_friend").load(window.modal_2_url)),update_page($("#sender").text(),$("#send_user").val(),$("#send_img").attr("value"),$("#send_room").val(),$("#send_all_room").val()),check_size(),attach_basic(),scroll($("#unread").attr("value"),$("#list_chat").attr("value")),$(".md_loading").modal("hide"))})}function sf_cancel(){$(".md_sendfile").modal("hide"),$("#upload_file").val(""),$("#form_file")[0].reset()}function cc_cancel(){$("#cc_chat_name").val(""),$("#cc_friend_list").val(""),$("#cc_selection a").remove(),$("#select_friend div").removeClass().addClass("item select_option"),$("#cc_warn_list").hasClass("hiddened")||$("#cc_warn_list").addClass("hiddened"),$("#cc_warn_name").hasClass("hiddened")||$("#cc_warn_name").addClass("hiddened")}function au_add(e,a){for(i=0;i<e.length;i++){var s="#friend_"+e[i].id,d='<div class="item" id="user_'+e[i].id+'"><div class="ui comments white"><div class="comment"><div class="content"><div class="ui grid"><div class="three wide column"><a class="avatar"><img src="'+a+e[i].profile_pict+'"></a></div><div class="nine wide column"><a class="author">'+e[i].nama+'</a><div class="text status" id="status_'+e[i].id+'">Offline</div></div><div class="three wide column"><div class="led-box"><div class="led-red" id="ledlamp_'+e[i].id+'"></div></div></div></div></div></div></div></div>';$("#list_user").append(d),$(s).remove()}}function au_cancel(){$("#au_room").val(""),$("#au_list").val(""),$("#au_selection a").remove(),$("#au_select_friend div").removeClass().addClass("item select_option"),$("#au_warn_user").hasClass("hiddened")||$("#au_warn_user").addClass("hiddened")}function post_data(e,a){$.ajax({url:a,type:"post",dataType:"json",data:e,error:function(e){}})}function logoutuser(e,a){s="#status_"+e;$(s).text("Offline");s="#ledlamp_"+e;for($(s).removeClass("led-blue"),$(s).addClass("led-red"),index=0;index<a.length;index++){var s="#user_"+a[index];$(s).prependTo("#list_user")}}function updateuser(e){for(index=0;index<e.length;index++){a="#user_"+e[index];$(a).prependTo("#list_user");a="#status_"+e[index];$(a).text("Online");var a="#ledlamp_"+e[index];$(a).removeClass("led-red"),$(a).addClass("led-blue")}}function newmessage(e,a,s,d,t,i){n="#room_"+d;$(n).prependTo("#irp");n="#msg_new_"+d;2==parseInt(i)?$(n).text("[system] Image send by user"):3==parseInt(i)?$(n).text("[system] File send by user"):4==parseInt(i)?$(n).text("[system] Audio send by user"):5==parseInt(i)?$(n).text("[system] Video send by user"):$(n).text(e);n="#msg_time_"+d;if($(n).text(a),parseInt(d)!=parseInt(s)){var n="#notif_"+d,o=parseInt($(n).text())+1;$(n).text(o),$(n).removeClass("hiddened"),post_data({room:d,unread:o},t)}}function receivemessage(e,a,s,d,t,i,n){var o;e==a?$(".main_chat").append('<div class="two column row"><div class="four wide column"></div><div class="twelve wide column"><div class="ui right floated comments"> <div class="comment"><a class="avatar c_avatar"></a><div class="content com_con"><a class="author c_author"></a><div class="metadata"></div><div class="text msg_data mod_send"></div></div></div></div></div></div>'):$(".main_chat").append('<div class="two column row"><div class="twelve wide column"><div class="ui comments"> <div class="comment"><a class="avatar c_avatar"></a><div class="content com_con"><a class="author c_author"></a><div class="metadata"></div><div class="text msg_data mod_receive"></div></div></div></div></div></div>');var l=$("<img>",{src:i});$(".c_avatar").last().append(l),$(".c_author").last().text(s);var c=$("<div>",{class:"date"}).text(t);$(".metadata").last().append(c),2==parseInt(n)?o=$("<img>").attr("src",d).addClass("msg_image"):3==parseInt(n)?(index_start=d.lastIndexOf("/")+1,index_end=d.length,o="<p>"+d.slice(index_start,index_end)+' :</p><a href="'+d+'" download><div class="ui center aligned segment"><i class="download icon" style="font-size: 6em !important;"></i></div></a>'):4==parseInt(n)?(index_start=d.lastIndexOf("/")+1,index_end=d.length,o="<p>"+d.slice(index_start,index_end)+' :</p><audio controls class="msg_audio"><source src="'+d+'" type="audio/mpeg"></audio>'):o=5==parseInt(n)?'<video controls class="msg_video"><source src="'+d+'" type="video/mp4"></video>':$("<p>").text(d),$(".msg_data").last().append(o)}function scrolltobottom(){var e=$(".main")[0].scrollHeight;$(".main").animate({scrollTop:e},"slow")}function attach_basic(){$("#sd_chatlist").sidebar({context:$(".bottom.segment")}).sidebar("attach events","#sd_clbutton"),$("#sd_groupuser").sidebar({context:$(".bottom.segment")}).sidebar("attach events","#sd_gubutton"),$("#send_room").val()>-1&&($(".md_adduser").modal("attach events","#au_button","show"),$(".md_leavegroup").modal("attach events","#lg_button","show")),$(".dropdown").dropdown({})}function scroll(e,a){if(e&&e>-1)if(e>0&&a>1){var s=$("#chat_"+(a-e)),d="#"+$(".main_chat:first-child").attr("id"),t=$(d),i=s.offset().top-t.offset().top;$(".main").animate({scrollTop:i},"slow")}else scrolltobottom()}function check_size(){var e=null!=navigator.userAgent.match(/iPad/i);if(window.matchMedia("(min-width: 1024px)").matches&&!e)$(".big_bold").css("font-size","2vw !important;"),$("#item_container").prependTo("#bg_chatlist"),$("#user_container").prependTo("#bg_groupuser"),$("#bg_chatlist").addClass("visible"),$("#bg_groupuser").addClass("visible"),$("#bg_topmenu").removeClass("hiddened"),$("#sm_topmenu").addClass("hiddened"),$("#main_body").css("width","calc(100vw - 350px)"),$(window).width()>1250?($("#main_container").css("width","calc(80vw - 350px)"),$("#bg_groupuser").css("width","20vw")):($("#main_container").css("width","calc(100vw - 601px)"),$("#bg_groupuser").css("width","251px")),$(".main").css("height","84vh"),$("#footer").css("width","calc(100% - 2em)"),$("#msg_area").removeClass("fourteen wide column"),$("#msg_area").addClass("fifteen wide column"),$("#btn_send").removeClass("two wide column"),$("#btn_send").addClass("one wide column");else if(window.matchMedia("(min-width: 768px)").matches){a="calc("+window.innerHeight+"px - (33px + 8vh))";$(".big_bold").css("font-size","5vw !important;"),$("#item_container").prependTo("#sd_chatlist"),$("#user_container").prependTo("#bg_groupuser"),$("#sd_gubutton").addClass("hiddened"),$("#bg_chatlist").removeClass("visible"),$("#bg_groupuser").addClass("visible"),$("#sm_topmenu").removeClass("hiddened"),$("#bg_topmenu").addClass("hiddened"),$("#main_body").css("width","100vw"),$(window).width()>833?($("#main_container").css("width","70vw"),$("#bg_groupuser").css("width","30vw")):($("#main_container").css("width","calc(100vw - 251px)"),$("#bg_groupuser").css("width","251px")),$(".main").css("height",a),$("#footer").css("width","100%"),$("#msg_area").removeClass("fifteen wide column"),$("#msg_area").addClass("fourteen wide column"),$("#btn_send").removeClass("one wide column"),$("#btn_send").addClass("two wide column")}else{var a="calc("+window.innerHeight+"px - (33px + 8vh))";$(".big_bold").css("font-size","5vw !important;"),$("#item_container").prependTo("#sd_chatlist"),$("#user_container").prependTo("#sd_groupuser"),$("#sd_gubutton").removeClass("hiddened"),$("#bg_chatlist").removeClass("visible"),$("#bg_groupuser").removeClass("visible"),$("#sm_topmenu").removeClass("hiddened"),$("#bg_topmenu").addClass("hiddened"),$("#main_body").css("width","100vw"),$("#main_container").css("width","100vw"),$(".main").css("height",a),$("#footer").css("width","100%"),$("#msg_area").removeClass("fifteen wide column"),$("#msg_area").addClass("fourteen wide column"),$("#btn_send").removeClass("one wide column"),$("#btn_send").addClass("two wide column")}}function init(){$(document).on("click",".msg_image",function(){var e=$(this).attr("src");$("#image_modal").attr("src",e),$("#md_imagemodal").modal("show")}),$(document).on("keyup","#search_room",function(){var e=$("#search_room").val();filter=e.toUpperCase(),$(".change_room").each(function(){$(this).find(".header").text().toUpperCase().indexOf(filter)>-1?$(this).css("display",""):$(this).css("display","none")})}),$(document).on("click",".bt_sendfile",function(){$(".md_sendfile").modal("show")}),$(document).on("click","#sf_cancel",function(){sf_cancel()}),$(document).on("click","#sf_send",function(){$(".md_sendfile").modal("hide"),$(".md_loading").modal("setting","closable",!1).modal("show");var e=document.getElementById("upload_file").files,a=new FormData,s=e[0];a.append("file",s,s.name),$.ajax({url:window.uploadfile_url,dataType:"JSON",cache:!1,contentType:!1,processData:!1,data:a,type:"POST",success:function(e){e?($("#upload_file").val(""),$("#form_file")[0].reset(),socket.emit("chat message",e.url,e.tipe,e.time),$(".md_loading").modal("hide")):($(".md_loading").modal("hide"),$(".md_errorfile").modal("show"))},error:function(e){$(".md_loading").modal("hide"),$(".md_error").modal("show")}})}),$(document).on("click","#nc_button",function(){$("#md_createchat").modal("show")}),$(document).on("click",".change_room",function(){var e=$(this).attr("id");e=e.split("_")[1],$(".md_loading").modal("setting","closable",!1).modal("show"),go_to(e)}),$(document).on("click","#ok_createchat",function(){$("#cc_chat_name").val()&&$("#cc_friend_list").val()?($("#md_createchat").modal("hide"),$(".md_loading").modal("setting","closable",!1).modal("show"),$.ajax({url:window.createchat_url,type:"post",dataType:"json",data:{group_name:$("#cc_chat_name").val(),user_id:$("#send_user").val(),friend_list:$("#cc_friend_list").val()},success:function(e){cc_cancel(),window.socket.emit("add chat",e.name,e.image,e.room,e.list),window.socket.emit("join chat",e.room,$("#send_user").val()),go_to(e.room)},error:function(){$(".md_loading").modal("hide"),$(".md_error").modal("show")}})):($("#cc_chat_name").val()?$("#cc_warn_name").hasClass("hiddened")||$("#cc_warn_name").addClass("hiddened"):$("#cc_warn_name").removeClass("hiddened"),$("#cc_friend_list").val()?$("#cc_warn_list").hasClass("hiddened")||$("#cc_warn_list").addClass("hiddened"):$("#cc_warn_list").removeClass("hiddened"))}),$(document).on("click","#cancel_createchat",function(){$("#md_createchat").modal("hide"),cc_cancel()}),$(document).on("click","#au_cancel",function(){$(".md_adduser").modal("hide"),au_cancel()}),$(document).on("click","#lc_ok",function(){$(".md_leavegroup").modal("hide"),$(".md_loading").modal("show"),$.ajax({url:window.leavechat_url,type:"post",dataType:"json",data:{room:$("#send_room").val(),user_id:$("#send_user").val()},success:function(e){socket.emit("remove user",!0)},error:function(e){$(".md_loading").modal("hide"),$(".md_error").modal("show")}})}),$(document).on("click","#au_add",function(){$("#au_list").val()?($(".md_adduser").modal("hide"),$(".md_loading").modal("setting","closable",!1).modal("show"),$.ajax({url:window.adduser_url,type:"post",dataType:"json",data:{room:$("#send_room").val(),user_list:$("#au_list").val()},success:function(e){au_cancel(),window.socket.emit("add user",$("#send_room").val(),e,$("#grouproom_name").attr("value"),$("#grouproom_image").attr("value")),au_add(e,window.imagebase_url),$(".md_loading").modal("hide")},error:function(e){$(".md_loading").modal("hide"),$(".md_error").modal("show")}})):$("#au_list").val()?$("#au_warn_user").hasClass("hiddened")||$("#au_warn_user").addClass("hiddened"):$("#au_warn_user").removeClass("hiddened")}),$(document).on("submit",".formsend",function(e){if(e.preventDefault(),e.returnValue=!1,$("#send_room").val()>-1){var a=$(".chat_message").val(),s={tipe:1,msg:a};$.ajax({url:window.sendmsg_url,type:"post",dataType:"json",data:s,success:function(e){window.socket.emit("chat message",a,1,e)}})}$(".chat_message").val("")})}$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("active")}),$(window).on("load",check_size),$(window).on("resize",check_size);